################################################################################
# This file was generated by Ansible for {{ansible_fqdn}}
# Do NOT modify this file by hand!
################################################################################

################################################################################
# Global Settings
################################################################################
external_url "{{ gitlab_external_url }}"
gitlab_rails['time_zone'] = "{{ gitlab_time_zone }}"
git_data_dirs({ "default" => { "path" => "{{ gitlab_git_data_dir }}" } })

{% if gitlab_email_enabled == "true" %}
################################################################################
# Email Settings
################################################################################
gitlab_rails['gitlab_email_enabled'] = {{ gitlab_email_enabled }}
gitlab_rails['gitlab_email_from'] = "{{ gitlab_email_from }}"
gitlab_rails['gitlab_email_display_name'] = "{{ gitlab_email_display_name }}"
gitlab_rails['gitlab_email_reply_to'] = "{{ gitlab_email_reply_to }}"
{% endif %}

{% if gitlab_trusted_proxy is defined %}
################################################################################
# Trusted proxies
################################################################################
gitlab_rails['trusted_proxies'] = ['{{ gitlab_trusted_proxy }}']
{% endif %}

{% if gitlab_ldap_enabled == "true" %}
################################################################################
# LDAP Settings
################################################################################
gitlab_rails['ldap_enabled'] = {{ gitlab_ldap_enabled }}
gitlab_rails['ldap_host'] = '{{ gitlab_ldap_host }}'
gitlab_rails['ldap_port'] = {{ gitlab_ldap_port }}
gitlab_rails['ldap_uid'] = '{{ gitlab_ldap_uid }}'
gitlab_rails['ldap_method'] = '{{ gitlab_ldap_method}}' # 'ssl' or 'plain'
gitlab_rails['ldap_bind_dn'] = '{{ gitlab_ldap_bind_dn }}'
gitlab_rails['ldap_password'] = '{{ gitlab_ldap_password }}'
gitlab_rails['ldap_allow_username_or_email_login'] = true
gitlab_rails['ldap_base'] = '{{ gitlab_ldap_base }}'
{% endif %}

{% if gitlab_omniauth_enabled == "true" %}
################################################################################
# OmniAuth Settings
################################################################################
gitlab_rails['omniauth_enabled'] = {{ gitlab_omniauth_enabled }}
{% set list_providers = [] %}
{% for provider in gitlab_omniauth_providers %}
{% if list_providers.append(provider.name) %}{% endif %}
{% endfor %}
gitlab_rails['omniauth_allow_single_sign_on'] = ['{{ list_providers | join(', ')}}']
gitlab_rails['omniauth_block_auto_created_users'] = {{ gitlab_omniauth_block_auto_created_users }}
gitlab_rails['omniauth_providers'] = [
{% for provider in gitlab_omniauth_providers %}
   {
     "name" => "{{ provider.name }}",
     "app_id" => "{{ provider.app_id }}",
     "app_secret" => "{{ provider.app_secret }}",
     "args" => { "{{ provider.args }}" }
   },
{% endfor %}
 ]
{% endif %}



################################################################################
# Backup Settings
################################################################################
gitlab_rails['backup_path'] = "{{ gitlab_backup_path }}"
gitlab_rails['backup_keep_time'] = {{ gitlab_backup_keep_time }}

################################################################################
# GitLab Shell settings for GitLab
################################################################################
gitlab_rails['gitlab_shell_ssh_port'] = {{ gitlab_shell_ssh_port }}

{% if gitlab_smtp_enable == "true" %}
################################################################################
# GitLab email server settings
################################################################################
gitlab_rails['smtp_enable'] = {{ gitlab_smtp_enable }}
gitlab_rails['smtp_address'] = '{{ gitlab_smtp_address }}'
gitlab_rails['smtp_port'] = {{ gitlab_smtp_port }}
gitlab_rails['smtp_user_name'] = '{{ gitlab_smtp_user_name }}'
gitlab_rails['smtp_password'] = '{{ gitlab_smtp_password }}'
gitlab_rails['smtp_domain'] = '{{ gitlab_smtp_domain }}'
gitlab_rails['smtp_authentication'] = '{{ gitlab_smtp_authentication }}'
gitlab_rails['smtp_enable_starttls_auto'] = {{ gitlab_smtp_enable_starttls_auto }}
gitlab_rails['smtp_tls'] = {{ gitlab_smtp_tls }}
{% endif %}

################################################################################
# GitLab NGINX
################################################################################
{% if gitlab_nginx_listen_port is defined %}
nginx['listen_port'] = {{ gitlab_nginx_listen_port }}
{% endif %}
{% if gitlab_nginx_listen_https is defined %}
nginx['listen_https'] = {{ gitlab_nginx_listen_https }}
{% endif %}
nginx['redirect_http_to_https'] = {{ gitlab_redirect_http_to_https }}
{% if gitlab_create_self_signed_cert == "true" %}
nginx['ssl_certificate'] = "{{ gitlab_ssl_certificate }}"
nginx['ssl_certificate_key'] = "{{ gitlab_ssl_certificate_key }}"
{% endif %}

{% if gitlab_nginx_real_ip is defined %}
nginx['proxy_set_headers'] = {
  "X-Forwarded-Proto" => "https",
  "X-Forwarded-Ssl" => "on",
}
nginx['real_ip_trusted_addresses'] = ['{{ gitlab_nginx_real_ip }}']
nginx['real_ip_header'] = 'X-Real-IP'
nginx['real_ip_recursive'] = 'on'
{% endif %}

{% if gitlab_mattermost_enabled == "true" %}
################################################################################
# Mattermost Settings
################################################################################
{% for config in gitlab_mattermost_configs %}
{{ config }}
{% endfor %}
{% endif %}
